YUI.add("moodle-atto_pumukit-button",function(e,t){var n="atto_pumukit",r="pumukit_flavor",i="atto_pumukit",s={INPUTSUBMIT:"atto_media_urlentrysubmit",INPUTCANCEL:"atto_media_urlentrycancel",FLAVORCONTROL:"flavorcontrol"},o={FLAVORCONTROL:".flavorcontrol"},u='<iframe src="{{PUMUKITURL}}" frameborder="0" allowfullscreen style="width:100%;height:80vh"></iframe><form class="atto_form"><input class="{{CSS.FLAVORCONTROL}}" id="{{elementid}}_{{FLAVORCONTROL}}" name="{{elementid}}_{{FLAVORCONTROL}}" value="{{defaultflavor}}" type="hidden" /></form>';e.namespace("M.atto_pumukit").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{_receiveMessageBind:null,initializer:function(){if(this.get("disabled"))return;this.addButton({icon:"e/insert_edit_video",buttonName:"pumukit",callback:this._displayDialogue,callbackArgs:"iconone"})},_getFlavorControlName:function(){return this.get("host").get("elementid")+"_"+r},_displayDialogue:function(t,n){t.preventDefault();var r=900;this._receiveMessageBind=this._receiveMessage.bind(this),window.addEventListener("message",this._receiveMessageBind);var i=this.getDialogue({headerContent:this.get("dialogtitle"),width:r+"px",focusAfterHide:n});i.width!==r+"px"&&i.set("width",r+"px");var s=this._getFormContent(n),o=e.Node.create("<div></div>");o.append(s),i.set("bodyContent",o),i.show(),this.markUpdated()},_getFormContent:function(t){var i=e.Handlebars.compile(u),o=e.Node.create(i({elementid:this.get("host").get("elementid"),CSS:s,FLAVORCONTROL:r,PUMUKITURL:this.get("pumukiturl"),component:n,defaultflavor:this.get("defaultflavor"),clickedicon:t}));return this._form=o,o},_doInsert:function(e){e.preventDefault(),this.getDialogue({focusAfterHide:null}).hide();var t=this._form.one(o.FLAVORCONTROL);if(!t.get("value"))return;this.editor.focus(),this.get("host").insertContentAtFocusPoint(t.get("value")),this.markUpdated()},_receiveMessage:function(e){if(e.data.type!="atto_pumukit")return;e.preventDefault(),this.getDialogue({focusAfterHide:null}).hide();if(!e.data.url)return;window.removeEventListener("message",this._receiveMessageBind),this.editor.focus(),this.get("host").insertContentAtFocusPoint(e.data.url),this.markUpdated()}},{ATTRS:{pumukiturl:{value:""},dialogtitle:{value:""}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});
